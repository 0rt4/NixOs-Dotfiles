#!/usr/bin/env bash

# Script para limpiar generaciones antiguas y optimizar el store
# Coloca este archivo en ~/nixos-config/modules/scripts/clean.sh

set -e

echo "ğŸ§¹ Limpiando sistema NixOS..."

# Eliminar generaciones antiguas (mÃ¡s de 3 dÃ­as)
echo "ğŸ—‘ï¸  Eliminando generaciones antiguas del sistema..."
sudo nix-collect-garbage --delete-older-than 1d

# Eliminar generaciones antiguas del usuario
echo "ğŸ—‘ï¸  Eliminando generaciones antiguas del usuario..."
nix-collect-garbage --delete-older-than 1d

# Optimizar el store
echo "âš¡ Optimizando Nix store..."
sudo nix-store --optimise
sudo nix store gc


# Archivos temporales
echo "ğŸ—‘ï¸ Borrando archivos temporales..."
sudo rm -rf /tmp/*
sudo rm -rf /var/tmp/*
sudo rm -rf ~/.cache/*
sudo rm -rf /var/lib/systemd/coredump/*
sudo nix-env --delete-generations old

rm -f "$PLAYLIST"
sudo journalctl --vacuum-time=7d

echo "âœ… Limpieza completada!"
